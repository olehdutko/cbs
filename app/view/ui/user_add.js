/*
 * File: app/view/ui/user_add.js
 * Date: Mon Sep 05 2011 19:04:54 GMT+0300 (FLE Daylight Time)
 *
 * This file was generated by Ext Designer version 1.2.0.
 * http://www.sencha.com/products/designer/
 *
 * This file will be auto-generated each and everytime you export.
 *
 * Do NOT hand edit this file.
 */
var str_Stan = 'Chyslytsia';
var str_Type = 'Postachalnik'

Ext.define('Borsuko.view.ui.user_add', {
    extend: 'Ext.form.Panel',

    autoRender: true,
    autoShow: true,
    frame: true,
    id: 'form',
    itemId: 'form',
    styleHtmlContent: true,
    autoScroll: true,
    maintainFlex: true,
    layout: {
        type: 'auto'
    },
    bodyPadding: 10,
    animCollapse: false,
    collapseFirst: false,
    collapsed: false,
    collapsible: true,
    frameHeader: false,
    title: 'Додавання контрагенту',
    titleCollapse: true,
    pollForChanges: true,
    paramsAsHash: true,
    standardSubmit: true,
    trackResetOnLoad: true,

    initComponent: function() {
        var me = this;
        me.items = [
            {
                xtype: 'fieldset',
                frame: true,
                padding: 10,
                width: 852,
                items: [
                    /*{
                        xtype: 'textfield',
                        id: 'nomer',
                        width: 350,
                        fieldLabel: 'Номер',
                        labelWidth: 150
                    },*/
                    {
                        xtype: 'textfield',
                        id: 'login',
                        width: 500,
                        fieldLabel: 'Логін',
                        labelWidth: 150,
                        emptyText: 'Логін'
                    },
                    {
                        xtype: 'textfield',
                        id: 'password',
                        width: 500,
                        fieldLabel: 'Пароль',
                        labelWidth: 150,
                        emptyText: 'Пароль'
                    },
                   
                    {
                        xtype: 'datefield',
						hidden:true,
						format : "d/m/Y",
                        id: 'date',
                        width: 500,
                        name: 'date',
                        fieldLabel: 'Дата',
						listeners: {
						render: function() {
							this.setValue(new Date());
						}
						},
                        labelWidth: 150
                    },
                    
                    {
                            xtype: 'combobox',
                            id: 'role',
							fieldLabel: 'Роль',
							labelWidth: 150,
                            displayField: 'type',
                            queryMode: 'local',
							editable: false,
                            store: 'roles_store',
                            valueField: 'type'
                        },
                    {
                        xtype: 'textareafield',
                        height: 85,
                        id: 'prymitka',
                        width: 500,
                        fieldLabel: 'Примітка',
                        labelWidth: 150,
                        emptyText: 'Примітка'
                    }
                ]
            }
        ];
        me.dockedItems = [
            {
                xtype: 'toolbar',
                dock: 'top',
                items: [
                    {
                        xtype: 'button',
                        id: 'add',
                        text: 'Добавити Користувача',
						iconCls: 'add16',
						handler : function(){
							AddUser()
						}
                    }
                ]
            }
        ];
        me.callParent(arguments);
    }
});


function AddUser(){	
		/*//var str_nomer = Ext.getCmp("nomer").getValue();
		var str_Login = Ext.getCmp("login").getValue();
		var str_Password = hex_md5(Ext.getCmp("password").getValue());
		var str_Role = Ext.getCmp("role").getValue();
		var str_Prymitka = Ext.getCmp("prymitka").getValue();
		var str_Date = Ext.getCmp("date").getValue();

		alert(str_Password);*/
		
		
		
		if(Ext.getCmp('login').isValid() && Ext.getCmp('password').isValid() && Ext.getCmp('role').isValid()){
                  Ext.Ajax.request({
                    url: '/php/AddNewUser.php',
                    params: {
                      prymitka: Ext.getCmp("prymitka").getValue(),
					  username:Ext.getCmp("login").getValue(),
                      password: hex_md5(Ext.getCmp("password").getValue()),
					  role: Ext.getCmp("role").getValue()
					  
					  
					  
                    },
                    success: function(response, opts) 
					{
					    Ext.MessageBox.show({
                          title: 'Повідомлення',
                          msg: 'Користувач був успішно доданий',
                          buttons: Ext.MessageBox.OK,
                          icon: Ext.MessageBox.INFO
                        });
						window.location = "users.php";
                    },
                    failure: function(response, opts) 
					{
						Ext.MessageBox.show({
						title: 'Помилка',
						msg: 'Помилка при додаванні користувача до системи',
						buttons: Ext.MessageBox.OK,
						icon: Ext.MessageBox.ERROR
						});
                    }
                  });
                } 
				else 
				{
                  Ext.MessageBox.show({
                    title: 'Помилка',
                    msg: 'Введіть логін, пароль та роль користувача ',
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                  });
                }
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
	/*Ext.Ajax.request(
	{
		url: './php/insert_kontragent.php',
		params: {
			//objnomer: str_nomer,
			PIB: str_PIB,
			prymitka: str_prymitka,
			telefon: str_telefon,
			info: str_info,
			date: str_date,
			Type: str_Type,
			Stan: str_Stan
		},
		success: function()
		{
			Ext.MessageBox.alert('Контрагент доданий!', 'Контрагент доданий');
			//window.location = "./kontragenty_view.php";
		},
		failure: function(response)
		{
			Ext.MessageBox.alert('Помилка', 'Неможливо доступитися до бази даних');
		}
	})*/
	}